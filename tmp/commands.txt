HF_DATASETS_CACHE=/data-3/priyam/tmp python perform_templating.py \
    --glob_path "/data-3/priyam/translation/data/wiki_en/wiki_en_data.parquet" \
    --cache_dir_for_original_data "/data-3/priyam/translation/data/wiki_en/cache" \
    --base_save_path "/data-3/priyam/translation/output/wiki_en/doc_csvs" \
    --save_path "/data-3/priyam/translation/output/wiki_en/template_wiki_en.csv" \
    --text_col body \
    --url_col url \
    --timestamp_col timestamp \
    --source_type wiki_en \
    --translation_type sentence \
    --use_cache \
    --write_to_mini_csvs \
    --write_style "doc" \
    --split "train[:5%]"

HF_DATASETS_CACHE=/data-3/priyam/tmp python perform_templating.py \
    --glob_path "/data-3/priyam/translation/data/wiki_en/wiki_en_data.parquet" \
    --cache_dir_for_original_data "/data-3/priyam/translation/data/wiki_en/cache" \
    --base_save_path "/data-3/priyam/translation/output/wiki_en/doc_csvs" \
    --save_path "/data-3/priyam/translation/output/wiki_en/templated" \
    --text_col body \
    --url_col url \
    --timestamp_col timestamp \
    --source_type wiki_en \
    --translation_type sentence \
    --use_cache \
    --split "train[:5%]"

HF_DATASETS_CACHE=/data-3/priyam/tmp python setu-translate/stages/perform_templating.py \
    --glob_path "/data-3/priyam/translation/data/parquets/wikimedia/*.parquet" \
    --cache_dir_for_original_data "/data-3/priyam/tmp" \
    --save_path "/data-3/priyam/translation/data/wikimedia/templated" \
    --base_save_path "output/wikimedia_en" \
    --text_col "text" \
    --url_col "url" \
    --timestamp_col "timestamp" \
    --source_type "wikimedia" \
    --split "train" \
    --translation_type "sentence" \
    --use_cache True

#    --id_col ID_COL


        # data_files=glob.glob("/data-3/priyam/translation/refinedweb-mini/100_000.parquet"),
        # cache_dir="/data-3/priyam/translation/refinedweb-mini/cache",
        # rw_templated_filtered.to_csv(f"/data-3/priyam/translation/output/translation/template_{sample_size}.csv")

HF_DATASETS_CACHE=/home/llm/translate/tmp python translate_dummy.py \
    --data_glob_path "/home/llm/translate/output/wiki_en/doc_csvs/paths.csv" \
    --cache_dir "/home/llm/translate/data/wiki_en/cache" \
    --model_ckpt "ai4bharat/indictrans2-en-indic-dist-200M" \
    --src_lang "eng_Latn" \
    --dest_lang "hin_Deva" \
    --direction "en-indic" \
    --loader_workers 96 \
    --model_batch_size 1024 \
    --prefetch_factor 8 \
    --csv_batch_size 32 \
    --devices 0,1,2,3,4,5,6,7

HF_DATASETS_CACHE=/home/llm/translate/tmp python translate_dummy.py \
    --data_glob_path "/home/llm/translate/output/wiki_en/doc_csvs/paths.csv" \
    --cache_dir "/home/llm/translate/data/wiki_en/cache" \
    --model_ckpt "ai4bharat/indictrans2-en-indic-dist-200M" \
    --src_lang "eng_Latn" \
    --dest_lang "hin_Deva" \
    --direction "en-indic" \
    --loader_workers 96 \
    --model_batch_size 1024 \
    --prefetch_factor 8 \
    --csv_batch_size 32 \
    --devices 0

python create_global_ds.py \
    --paths_data "/home/llm/translate/output/wiki_en/doc_csvs/paths.csv" \
    --cache_dir "/home/llm/translate/data/wiki_en/cache" \
    --global_sent_ds_path "/home/llm/translate/output/wiki_en/global_sentences_wiki_en.csv"

python create_global_ds.py \
    --paths_data "/data-3/priyam/translation/output/wiki_en/templated/*.arrow" \
    --cache_dir "/data-3/priyam/translation/data/wiki_en/cache" \
    --global_sent_ds_path "/data-3/priyam/translation/output/wiki_en/sentences"

python setu-translate/stages/create_global_ds.py \
    --paths_data "/data-3/priyam/translation/data/wikimedia/templated/*.arrow" \
    --cache_dir "/data-3/priyam/tmp" \
    --global_sent_ds_path "/data-3/priyam/translation/data/wikimedia/templated/sentences"

docker run --shm-size=2048m --gpus=\"device=0,1,2,3,4,5,6,7\" --rm -v ${PWD}/../checkpoints/:/models/checkpoints -p 8000:8000 -t indictrans2_triton



gcloud compute tpus tpu-vm create tlt-flax-build \
    --zone=us-central2-b \
    --accelerator-type=v4-64 \
    --version=tpu-ubuntu2204-base \
    --data-disk source=projects/sangraha-396106/zones/us-central2-b/disks/tlt-flax-disk,mode=read-write

gcloud compute tpus tpu-vm create tlt-flax-build \
    --zone=us-central2-b \
    --accelerator-type=v4-8 \
    --version=tpu-ubuntu2204-base \
    --data-disk source=projects/sangraha-396106/zones/us-central2-b/disks/tlt-flax-disk,mode=read-write

gcloud compute tpus tpu-vm create tlt-flax-build \
    --zone=us-central2-b \
    --accelerator-type=v4-64 \
    --version=tpu-ubuntu2204-base \
    --metadata=startup-script-url="gs://translation-ai4b/setu-translate/stages/tpu/setup_environment.sh" \
    --data-disk source=projects/sangraha-396106/zones/us-central2-b/disks/tlt-flax-disk,mode=read-only

gcloud compute tpus tpu-vm create tlt-flax-build \
    --zone=europe-west4-a \
    --accelerator-type=v3-8 \
    --version=tpu-ubuntu2204-base \
    --preemptible \
    --data-disk source=projects/sangraha-396106/zones/europe-west4-a/disks/tlt-flax-disk,mode=read-write

gcloud compute tpus tpu-vm create tlt-flax-build \
    --zone=us-central1-f \
    --accelerator-type=v2-8 \
    --version=tpu-ubuntu2204-base \
    --preemptible \
    --data-disk source=projects/sangraha-396106/zones/us-central1-f/disks/tlt-flax-disk,mode=read-write

gcloud alpha compute tpus tpu-vm attach-disk tlt-flax-build \
    --zone=europe-west4-a \
    --disk=tlt-flax-disk \
    --mode=read-write


gcloud compute tpus tpu-vm ssh tlt-flax-build \
    --zone=us-central2-b \
    --worker=all \
    --command="SETU_TRANSLATE_ROOT=/opt/setu-translate sudo python3 /opt/setu-translate/stages/tpu/translate_tpu_pmap.py --data_files gs://translation-ai4b/data_to_translate/wikimedia/binarized/hin_Deva/data-00000-of-00192.arrow --base_save_dir gs://translation-ai4b/test-out/wikimedia/hin_Deva --batch_size 2048 --total_procs 196 --accelerator_type "tpu" --on_gcp True --gcp_project sangraha-396106"


SETU_TRANSLATE_ROOT="/data/priyam/translation" bash /data/priyam/translation/setu-translate/scripts/run_binarize_and_translate.sh \
    --map_file "/data/priyam/translation/data/wiki-en/shards/mapping/device_map_0" \
    --data_cache_dir "/data/priyam/cache" \
    --joblib_temp_folder "/data/priyam/cache" \
    --src_lang "eng_Latn" \
    --tgt_lang "hin_Deva" \
    --num_procs_for_data_ops "64" \
    --batch_size "64" \
    --device "0" \
    --out_base_dir "/data/priyam/translation/outputs/wiki-en/shards_1627/out-longest" \
    --padding "longest"

SETU_TRANSLATE_ROOT="/data/priyam/translation" bash /data/priyam/translation/setu-translate/scripts/run_binarize_and_translate.sh \
    --map_file "/data/priyam/translation/data/wiki-en/shards/mapping/device_map_0" \
    --data_cache_dir "/data/priyam/cache" \
    --joblib_temp_folder "/data/priyam/cache" \
    --src_lang "eng_Latn" \
    --tgt_lang "hin_Deva" \
    --num_procs_for_data_ops "128" \
    --batch_size "1024" \
    --device "0" \
    --out_base_dir "/data/priyam/translation/outputs/wiki-en/shards_1627/out" \
    --padding "max_length"

HF_DATASETS_CACHE=/data/priyam/tmp python /data/priyam/translation/setu-translate/stages/tpu/translate_tpu.py \
        --root_dir "$PWD" \
        --data_files "/data/priyam/translation/outputs/wiki-en/shards_1627/out/*/hin_Deva/binarized_sentences/*.arrow" \
        --cache_dir /data/priyam/tmp \
        --base_save_dir "/data/priyam/translation/outputs/wiki-en/shards_1627/tpu-out/full/hin_Deva/model_out" \
        --joblib_temp_folder /data/priyam/tmp \
        --batch_size 256 \
        --total_procs 64 \
        --devices 0,1

SETU_TRANSLATE_ROOT="/mnt/disks/persist/translation" bash setu-translate/stages/tpu/binarize_all.sh \
    --map_folder "/mnt/disks/persist/translation/data/mapping/*" \
    --data_cache_dir "/mnt/disks/persist/tmp" \
    --src_lang "eng_Latn" \
    --tgt_lang "hin_Deva" \
    --num_procs_for_data_ops "128" \
    --batch_size "1024" \
    --device "0" \
    --out_base_dir "/mnt/disks/persist/translation/data/out" \
    --padding "max_length"

HF_DATASETS_CACHE=/mnt/disks/persist/tmp python /mnt/disks/persist/translation/setu-translate/stages/tpu/translate_tpu.py \
        --root_dir "$PWD" \
        --data_files "/data/priyam/translation/outputs/wiki-en/shards_1627/out/*/hin_Deva/binarized_sentences/*.arrow" \
        --cache_dir /data/priyam/tmp \
        --base_save_dir "/data/priyam/translation/outputs/wiki-en/shards_1627/tpu-out/full/hin_Deva/model_out" \
        --batch_size 256 \
        --total_procs 64 \
        --devices 0,1

HF_DATASETS_CACHE=/mnt/disks/persist/tmp python setu-translate/stages/tpu/translate_tpu_pmap.py \
--root_dir "$PWD" \
--data_files "/data/priyam/translation/outputs/wiki-en/shards_1627/out/9990000/hin_Deva/binarized_sentences/*.arrow" \   
--cache_dir /mnt/disks/persist/tmp \
--base_save_dir "/mnt/disks/persist/translation/out/" \
--batch_size 3072 \
--total_procs 64 \      
--devices 0,1,2,3


HF_DATASETS_CACHE=/data/priyam/tmp python /data/priyam/translation/setu-translate/stages/decode.py \
    --data_files "/data/priyam/translation/data/wikimedia/*/*.parquet" \
    --format "parquet" \
    --cache_dir /data/priyam/tmp \
    --decode_dir "/data/priyam/translation/data/wikimedia/hin_Deva/decoded" \
    --batch_size 1024 \
    --total_procs 64 \
    --src_lang eng_Latn \
    --tgt_lang hin_Deva




python evaluate_metrics.py \
    --base_save_dir /data/priyam/translation/setu-translate/stages/tpu/output/eval-results \
    --direction "en-indic" \
    --batch_size 256 \
    --total_procs 128 \
    --devices "2"


/mnt/disks/persist/minio-client/mc cp -r safi-hehe/ai4b-public-nlu-nlg/sangraha/translated/wiki-en/shards/shards_1627 /mnt/disks/persist/minio-client/translation/data/wiki-en/ 


0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49


/mnt/disks/persist/minio-cli/mc config host add safi-hehe https://objectstore.e2enetworks.net ZEBYMSQX84YO5SW8VIYV YU3NO3JK2WLE37X97BRONFG3QJ643MTL70P9DPJ3

/mnt/disks/persist/minio-cli/mc cp -r safi-hehe/ai4b-public-nlu-nlg/sangraha/translation/setu-translate .


HF_DATASETS_CACHE=/mnt/disks/persist/tmp python /mnt/disks/persist/translation/setu-translate/stages/binarize.py \
    --root_dir "$PWD" \
    --data_files "/mnt/disks/persist/translation/data/shards_1627/*/sentences/*.arrow" \
    --cache_dir /mnt/disks/persist/tmp \
    --binarized_dir "/mnt/disks/persist/translation/data/out/hin_Deva/binarized_sentences" \
    --batch_size 4096 \
    --total_procs 128 \
    --padding "max_length" \
    --src_lang "eng_Latn" \
    --tgt_lang "hin_Deva" \
    --return_format "np"

HF_DATASETS_CACHE=/mnt/disks/persist/tmp python setu-translate/stages/tpu/translate_tpu_pmap.py \
--root_dir "$PWD" \
--data_files "/mnt/disks/persist/translation/data/out/hin_Deva/binarized_sentences/*.arrow" \
--cache_dir /mnt/disks/persist/tmp \
--base_save_dir "/mnt/disks/persist/translation/data/out/hin_Deva/model-out" \
--batch_size 4096 \
--total_procs 128 \ 
--devices 0,1,2,3


mc cp -r /data-3/priyam/translation/raj-out/npi_Deva safi-hehe/ai4b-public-nlu-nlg/sangraha/translated/out/wikipedia
